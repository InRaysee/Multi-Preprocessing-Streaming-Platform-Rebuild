<!DOCTYPE html>

<html>

    <head>
        <title>videoTest</title>
    </head>

    <body>
        <div>
            <video id="video" style="height: 450px; width: 800px;" controls></video>
            <button id="0" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/init-stream_0.m4s')">0</button>
            <button id="1" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00001.m4s')">1</button>
            <button id="2" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00002.m4s')">2</button>
            <button id="3" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00003.m4s')">3</button>
            <button id="4" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00004.m4s')">4</button>
            <button id="5" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00005.m4s')">5</button>
            <button id="6" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00006.m4s')">6</button>
            <button id="7" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00007.m4s')">7</button>
            <button id="8" type="button" onclick="segmentAppend('http://222.20.126.109:8080/ffz/Tokyo/v7/chunk-stream_0-00008.m4s')">8</button>
            <!-- <button id="1" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_0.mp4')">1</button>
            <button id="2" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_24576.mp4')">2</button>
            <button id="3" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_49152.mp4')">3</button>
            <button id="4" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_73728.mp4')">4</button>
            <button id="5" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_98304.mp4')">5</button>
            <button id="6" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_122880.mp4')">6</button>
            <button id="7" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_147456.mp4')">7</button>
            <button id="8" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_172032.mp4')">8</button>
            <button id="9" type="button" onclick="segmentAppend('https://dash.akamaized.net/dash264/TestCases/2c/qualcomm/1/ED_1280_4M_MPEG2_video_196608.mp4')">9</button> -->
        </div>

        <script>
            var sourceBuffer

            function segmentAppend (url) {
                fetchBuffer(url, buffer => {
                        sourceBuffer.appendBuffer(buffer)
                })
            }

            function sourceOpen () {
                var mime = 'video/mp4; codecs="avc1.640033"'
                sourceBuffer = sourceBuffer ? sourceBuffer : mediaSource.addSourceBuffer(mime)
                mediaSource.duration = mediaSource.duration ? mediaSource.duration : 100

                fetchBuffer('http://222.20.126.109:8080/ffz/Tokyo/v7/init-stream_0.m4s', buffer => {
                        sourceBuffer.appendBuffer(buffer)
                })
            }
            
            function fetchBuffer (url, callback) {
                var xhr = new XMLHttpRequest;
                xhr.open('get', url);
                xhr.responseType = 'arraybuffer';
                xhr.onload = function () {
                    callback(xhr.response);
                };
                xhr.send();
            }

            var supportMediaSource = 'MediaSource' in window
            if (supportMediaSource) {
                var mediaSource = new MediaSource()
                var video = document.getElementById('video')
                video.src = URL.createObjectURL(mediaSource)

                mediaSource.addEventListener('sourceopen', sourceOpen)
            }
        </script>
    </body>

</html>