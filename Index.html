<!DOCTYPE html>

<html ng-app="DashPlayer" lang="en">

    <head>

		<meta charset="utf-8"/>

		<title>Multi-Processing Streaming Platform</title>
		<link rel="icon" type="image/jpg" href="../inraysee.jpg">

		<!-- Import css files -->
		<link rel="stylesheet" href="app/lib/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="app/lib/bootstrap/css/bootstrap-theme.css">
		<link rel="stylesheet" href="app/lib/bootstrap/css/bootstrap-glyphicons.css">
		<link rel="stylesheet" href="app/css/main.css">
		<link rel="stylesheet" href="app/contrib/akamai/controlbar/controlbar.css">

		<!-- Import src files -->
		<script src="app/lib/jquery/jquery-3.7.0.js"></script>
		<script src="app/lib/angular/angular.min.js"></script>
		<script src="app/lib/angular/angular-resource.min.js"></script>
		<script src="app/lib/angular/angular-flot.js"></script>
		<script src="app/lib/bootstrap/js/bootstrap.min.js"></script>
		<script src="app/lib/flot/jquery.flot.min.js"></script>
		<script src="app/lib/flot/jquery.flot.resize.min.js"></script>
		<script src="app/lib/flot/jquery.flot.axislabels.js"></script>
		<script src="app/contrib/cast_sender.js"></script>
		<script src="app/contrib/akamai/controlbar/ControlBar.js"></script>
		<script src="app/contrib/dash.js/dist/dash.all.debug.js"></script>
		<script src="app/main.js"></script>
		<!-- <script src="app/bundle.js"></script> -->
		<script src="app/contrib/dash.js/externals/Constants.js"></script>
		<script src="app/contrib/dash.js/externals/DashConstants.js"></script>
		<script src="app/contrib/dash.js/externals/BaseMatcher.js"></script>
		<script src="app/contrib/dash.js/externals/DateTimeMatcher.js"></script>
		<script src="app/contrib/dash.js/externals/DurationMatcher.js"></script>
		<script src="app/contrib/dash.js/externals/NumericMatcher.js"></script>
		<script src="app/contrib/dash.js/externals/StringMatcher.js"></script>
		<script src="app/contrib/webrtc/adapter-latest.js"></script>
		<script src="app/contrib/webrtc/capturer.js"></script>

		<!-- Import ABR rules -->
		<script src="RttThroughputRule.js"></script>
		<script src="RttBufferRule.js"></script>
		<script src="HighestBitrateRule.js"></script>
		<script src="LowestBitrateRule.js"></script>
		<script src="RttThroughputRule.js"></script>
		<script src="GlobalSwitchRule.js"></script>

		<style>
			body {
				background-color: #ececec;
				min-width: 1345px;
				overflow-x: hidden;
			}
		</style>
		
	</head>
	
    <body ng-controller="DashController" style="overflow: scroll;">

		<div class="container">

			<!-- Page title -->
			<div class="row title-header">
				<div class="branding">
					<span>Multi-Processing Streaming Platform</span>
				</div>
			</div>

			<!-- Control buttons -->
			<div class="row">
				<div class="input-group">
					<span class="input-group-btn">

						<!-- URL change list -->
						<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" style="vertical-align: bottom; width: 210px;">
							Change URL for All Streams <span class="caret"></span>
						</button>
						<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
							<li class="dropdown-submenu" ng-if="item.submenu" ng-repeat="item in availableStreams" ng-mouseover="onStreamItemHover(item)">
								<a tabindex="-1" href="#">{{item.type}}</a>
								<ul class="dropdown-menu">
									<li ng-repeat="subitem in item.submenu">
										<a ng-click="setStream(subitem)">{{subitem.name}}</a>
									</li>
								</ul>
							</li>
						</ul>
						
						<!-- Option show/hide button -->
						<button class="btn btn-default" ng-click="showoption()" style="width: 120px;" ng-cloak>{{optionButton}}</button>
						
						<!-- Reset button -->
						<button class="btn btn-default" type="button" style="width: 70px;" onclick="location.reload();">Reset</button>
						
						<!-- Load button -->
						<button id="Load" class="btn btn-primary" type="button" style="width: 70px;" ng-click="loadStream();">Load</button>
						
						<!-- Reload button -->
						<button id="Reload" class="btn btn-primary" type="button" style="width: 70px; display: none;" ng-click="reloadStream();">Reload</button>
						
						<!-- Option panel -->
						<div id="option" class="row" style="display: none;">

							<!-- Streaming mode -->
							<div style="float: left; border: 0px; margin: 0px; background-color: #d8e6ff; width: 20%; min-width: max-content; height: 335px;">
								<div class="options-item-title">Streaming Mode</div>
								<div class="options-item-body">
									<form>
										<label data-toggle="tooltip" data-placement="right">
											<input name="modes" id="MultiPathMode" type="radio" autocomplete="off" ng-click="changeMode('Multi-Path')" checked="true">
											Multi-Path
										</label>
										<label data-toggle="tooltip" data-placement="right">
											<input name="modes" id="ChatMode" type="radio" autocomplete="off" ng-click="changeMode('Chat')">
											Chat
										</label>
											<label data-toggle="tooltip" data-placement="right" id="input-output" style="margin-left: 10px;">
												<div class="row">
													<label for="videoCapture">Video capture source </label><select id="videoCapture"></select>
												</div>
												<div class="row">
													<label for="audioCapture">Audio capture source </label><select id="audioCapture"></select>
												</div>
											</label>
									</form>
								</div>
							</div>

							<!-- Video/audio path settings -->
							<div style="float: left; border: 0px; margin: 0px; background-color: #ececec; width: 20%; min-width: max-content; height: 335px;">
								<div class="options-item-title">Number of Paths</div>
								<div class="options-item-body">
									<label data-toggle="tooltip" data-placement="right">
										Number of videos
										<input style="width: 200px;" step="1" max="20" min="1" type="number" id="video-number" ng-model="streamNum.video" ng-change="changeStreamNumber('video')">
									</label>
									<label data-toggle="tooltip" data-placement="right">
										Number of audios
										<input style="width: 200px;" step="1" max="20" min="0" type="number" id="audio-number" ng-model="streamNum.audio" ng-change="changeStreamNumber('audio')">
									</label>
								</div>
							</div>

							<!-- Initial settings -->
							<div style="float: left; border: 0px; margin: 0px; background-color: #d8e6ff; width: 20%; min-width: max-content; height: 335px;">
								<div class="options-item-title">Initial Settings</div>
								<div class="options-item-body">
									<label data-toggle="tooltip" data-placement="right">
										Target buffer length (s)
										<input style="width: 200px;" step="1" min="0" type="number" id="target-buffer" ng-model="targetBuffer">
									</label>
									<label data-toggle="tooltip" data-placement="right">
										Maximal buffer length (s)
										<input style="width: 200px;" step="1" min="10" type="number" id="maximal-buffer" ng-model="maximalBuffer">
									</label>
									<label data-toggle="tooltip" data-placement="right">
										Schedule Interval (ms)
										<input style="width: 200px;" step="10" min="0" type="number" id="schedule-interval" ng-model="INTERVAL_OF_SCHEDULE_FETCHER">
									</label>
								</div>
							</div>

							<!-- ABR strategies -->
							<div style="float: left; border: 0px; margin: 0px; background-color: #ececec; width: 20%; min-width: max-content; height: 335px;">
								<div class="options-item-title">ABR Strategies</div>
								<div class="options-item-body">
									<form>
										<label data-toggle="tooltip" data-placement="right">
											<input name="abr-rules" id="rttThroughputRule" type="radio" autocomplete="off" ng-click="changeABRStrategy('rttThroughputRule')">
											RttThroughputRule
										</label>
										
										<label data-toggle="tooltip" data-placement="right">
											<input name="abr-rules" id="rttBufferRule" type="radio" autocomplete="off" ng-click="changeABRStrategy('rttBufferRule')">
											RttBufferRule
										</label>

										<label data-toggle="tooltip" data-placement="right">
											<input name="abr-rules" id="highestBitrateRule" type="radio" autocomplete="off" ng-click="changeABRStrategy('highestBitrateRule')" checked="true">
											HighestBitrateRule
										</label>

										<label data-toggle="tooltip" data-placement="right">
											<input name="abr-rules" id="lowestBitrateRule" type="radio" autocomplete="off" ng-click="changeABRStrategy('lowestBitrateRule')">
											LowestBitrateRule
										</label>

										<label data-toggle="tooltip" data-placement="right">
											<input name="abr-rules" id="globalSwitchRule" type="radio" autocomplete="off" ng-click="changeABRStrategy('globalSwitchRule')">
											GlobalSwitchRule
										</label>
											<label data-toggle="tooltip" data-placement="right" id="label-preferred-quality-seleceted-video" style="margin-left: 10px;">
												<div class="row">
													<span style="line-height: 25px;">Video quality</span>
													<input style="width: 40px;" step="1" min="0" max="100" type="number" id="global-quality-video" ng-model="globalQuality.video" disabled>	
												</div>
												<div class="row">
													<span style="line-height: 25px;">Audio quality</span>
													<input style="width: 40px;" step="1" min="0" max="100" type="number" id="global-quality-audio" ng-model="globalQuality.audio" disabled>	
												</div>
											</label>

										<label data-toggle="tooltip" data-placement="right">
											<input name="life_signal" id="life_signal" type="checkbox" autocomplete="off" ng-model="lifeSignalEnabled" checked>
											Life signal enabled
										</label>
									</form>
								</div>
							</div>

							<!-- Catchup settings -->
							<div style="float: left; border: 0px; margin: 0px; background-color: #d8e6ff; width: 20%; min-width: max-content; height: 335px;">
								<div class="options-item-title">Catchup Settings</div>
								<div class="options-item-body">
									<form>
										<label data-toggle="tooltip" data-placement="right">
											Target latency (s)
											<input style="width: 200px;" step="0.1" min="-10" type="number" id="target-latency" ng-model="targetLatency">
										</label>
										<label data-toggle="tooltip" data-placement="right">
											Minimal drift (s)
											<input style="width: 200px;" min="0.0" max="0.5" step="0.01" type="number" id="min-drift" ng-model="minDrift">
										</label>
										<label data-toggle="tooltip" data-placement="right" style="display: none;">
											Maximal drift (s)
											<input style="width: 200px;" min="1" max="20" step="1" type="number" id="max-drift" ng-model="maxDrift" disabled>
										</label>
										<label data-toggle="tooltip" data-placement="right">
											Catchup playback rate
											<input style="width: 200px;" min="0.0" max="1.0" step="0.01" type="number" id="catchup-playback-rate" ng-model="catchupPlaybackRate">
										</label>
										<label data-toggle="tooltip" data-placement="right" style="display: none;">
											Catchup latency threshold (s)
											<input style="width: 200px;" min="0" type="number" id="catchup-threshold" ng-model="liveCatchupLatencyThreshold" disabled>
										</label>
										<label data-toggle="tooltip" data-placement="right">
											<input name="catch_up" id="catch_up" type="checkbox" autocomplete="off" ng-model="catchupEnabled" checked>
											Catchup enabled
										</label>
										<label data-toggle="tooltip" data-placement="right">
											<input name="low_latency_dash" id="low_latency_dash" type="checkbox" autocomplete="off" ng-model="llDashEnabled" checked>
											LL-DASH enabled
										</label>
									</form>
								</div>
							</div>

						</div>

					</span>
				</div>
			</div>

			<!-- Video Source URLs -->
			<div id="videoSource">
				<div class="row" ng-repeat="url in streamURLs.video track by $index">
					<div class="input-group">
						<div class="input-group-btn">
							<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" style="vertical-align: bottom; width: 210px;">
								Change URL for Video {{$index + 1}} <span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
								<li class="dropdown-submenu" ng-if="item.submenu" ng-repeat="item in availableStreams" ng-mouseover="onStreamItemHover(item)">
									<a tabindex="-1" href="#">{{item.type}}</a>
									<ul class="dropdown-menu">
										<li ng-repeat="subitem in item.submenu">
											<a ng-click="setStream(subitem, 'video', this.$parent.$parent.$parent.$index)">{{subitem.name}}</a>
										</li>
									</ul>
								</li>
							</ul>
						</div>
						<input type="text" class="form-control" ng-model="streamURLs.video[$index]" ng-change ="">
					</div>
				</div>
			</div>

			<!-- Audio Source URLs -->
			<div id="audioSource">
				<div class="row" ng-repeat="url in streamURLs.audio track by $index">
					<div class="input-group">
						<div class="input-group-btn">
							<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" style="vertical-align: bottom; width: 210px;">
								Change URL for Audio {{$index + 1}} <span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
								<li class="dropdown-submenu" ng-if="item.submenu" ng-repeat="item in availableStreams" ng-mouseover="onStreamItemHover(item)">
									<a tabindex="-1" href="#">{{item.type}}</a>
									<ul class="dropdown-menu">
										<li ng-repeat="subitem in item.submenu">
											<a ng-click="setStream(subitem, 'audio', $index)">{{subitem.name}}</a>
										</li>
									</ul>
								</li>
							</ul>
						</div>
						<input type="text" class="form-control" ng-model="streamURLs.audio[$index]" ng-change ="">
					</div>
				</div>
			</div>

			<!-- Player and status -->
			<div class="row">

				<!-- Video container -->
				<div class="">

					<!-- Flat -->
					<div id="videoContainer" class="videoContainer" style="background-color:#3a3d42; width:calc(100% - 420px); height:565px; float:left;">
						<video id="video" style="display: flex; width:100%; height:530px;"></video>
						<div id="videoController" class="video-controller unselectable" style="display: block;">
							<div id="playPauseBtn" class="btn-play-pause" title="Play/Pause">
								<span id="iconPlayPause" class="icon-play"></span>
							</div>
							<span id="videoTime" class="time-display">00:00:00</span>
							<div id="fullscreenBtn" class="btn-fullscreen control-icon-layout" title="Fullscreen">
								<span class="icon-fullscreen-enter"></span>
							</div>
							<input type="range" id="volumebar" class="volumebar" value="1" min="0" max="1" step=".01">
							<div id="muteBtn" class="btn-mute control-icon-layout" title="Mute">
								<span id="iconMute" class="icon-mute-off"></span>
							</div>
							<div id="bitrateListBtn" class="control-icon-layout" title="Bitrate List">
								<span class="icon-bitrate"></span>
							</div>
							<div id="trackSwitchBtn" class="control-icon-layout" title="A/V Tracks">
								<span class="icon-tracks"></span>
							</div>
							<div id="captionBtn" class="btn-caption control-icon-layout" title="Closed Caption">
								<span class="icon-caption"></span>
							</div>
							<span id="videoDuration" class="duration-display">00:00:00</span>
							<div class="seekContainer">
								<div id="seekbar" class="seekbar seekbar-complete">
									<div id="seekbar-buffer" class="seekbar seekbar-buffer"></div>
									<div id="seekbar-play" class="seekbar seekbar-play"></div>
								</div>
							</div>
						</div>
					</div>

					<div id="cameraContainer" class="cameraContainer" style="position: absolute; background-color:#3a3d42; border: 2px solid #3a3d42; margin: 20px; width:240px; height:135px; display: none;">
						<video id="camera" style="width:100%; height:100%;" playsinline autoplay></video>
					</div>

				</div>

				<!-- Tab panes -->
				<div class="tabs-section" style="width:400px; height:565px; float:left; margin-left:20px;">
					<div class="tab-content">
						<div class="panel-body panel-stats" style="height: 565px;" ng-cloak>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">UTC Time: </label> {{utcTimeFormatted}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Startup Time: </label> {{streamStartTimeFormatted ? streamStartTimeFormatted : startupTimeFormatted || utcTimeFormatted}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Run Time: </label> {{(startupTime ? (utcTime - startupTime) / 1000 : 0).toFixed(3)}} s
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Timeline: </label> {{(streamElement.currentTime || 0).toFixed(3)}} s
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Baseline: </label> {{(baselineTime || streamElement.currentTime || 0).toFixed(3)}} s
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Latency: </label> {{((baselineTime || streamElement.currentTime || 0) - (streamElement.currentTime || 0)).toFixed(3)}} s
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Buffer Level: </label> {{(monitorBufferLevel.video || 0).toFixed(3)}} s | {{(monitorBufferLevel.audio || 0).toFixed(3)}} s
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Downloading Quality: </label> {{((monitorDownloadingQuality.video || 0) / 1000).toFixed(0)}} kbps | {{((monitorDownloadingQuality.audio || 0) / 1000).toFixed(0)}} kbps
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Playback Quality: </label> {{((monitorPlaybackQuality.video || 0) / 1000).toFixed(0)}} kbps | {{((monitorPlaybackQuality.audio || 0) / 1000).toFixed(0)}} kbps
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Playback Rate: </label> {{streamElement ? streamElement.playbackRate || 1 : 1}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Stream Info (video): </label> {{streamInfo.video.pathIndex}} - {{streamInfo.video.periodIndex}} - {{streamInfo.video.adaptationSetIndex}} - {{streamInfo.video.representationIndex}} - {{streamInfo.video.segmentIndex}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Stream Info (audio): </label> {{streamInfo.audio.pathIndex}} - {{streamInfo.audio.periodIndex}} - {{streamInfo.audio.adaptationSetIndex}} - {{streamInfo.audio.representationIndex}} - {{streamInfo.audio.segmentIndex}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Stall Time: </label> {{(stallTime || 0).toFixed(3)}} s
							</div>
							<!-- <div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Normalized Time : </label> {{normalizedTime.toFixed(2)}} {{normalizedTime ? " s" : ""}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Total Throughput : </label> {{totalThroughput ? totalThroughput >= 8000000 ? (totalThroughput / 8000000).toFixed(2) : (totalThroughput / 8000).toFixed(0) : ""}} {{totalThroughput ? totalThroughput >= 8000000 ? " MB/s" : " kB/s" : ""}}
							</div>
							<div class="text-success">
								<label class="text-primary" data-toggle="tooltip" data-placement="top">Total QOE : </label> {{totalQOE.toFixed(2)}}
							</div> -->
						</div>
					</div>
				</div>
				
			</div>

			<!-- Charting -->
			<div class="chart-panel">

				<!-- Chart controllers and legends -->
				<div class="chart-controls" style="height: 50px;">
					<div class="btn-group">
						<button id="disable-chart-btn" class="btn btn-primary" ng-click="clearchartData()" ng-cloak>Clear
						</button>
					</div>
				</div>

				<!-- Charts -->
				<div id="chart-wrapper">
					<div class="chart-inventory" style="margin-bottom: 30px;">
					</div>
					<div id="legend-wrapper_bufferLevel" class="legend-wrapper">
					</div>
					<span style="display: block; margin-top: 20px; margin-bottom: 10px; margin-left: 20px; font: bold normal 16px sans-serif;" id="buffer-level-title">Buffer Level</span>
					<div class="chart-inventory" style="margin-bottom: 30px;">
						<flot dataset="chartData.bufferLevel" options="chartOptions.bufferLevel"></flot>
					</div>
					<div id="legend-wrapper_downloadingQuality" class="legend-wrapper">
					</div>
					<span style="display: block; margin-top: 20px; margin-bottom: 10px; margin-left: 20px; font: bold normal 16px sans-serif;" id="downloading-quality-title">Downloading Quality</span>
					<div class="chart-inventory" style="margin-bottom: 30px;">
						<flot dataset="chartData.downloadingQuality" options="chartOptions.downloadingQuality"></flot>
					</div>
					<div id="legend-wrapper_playbackQuality" class="legend-wrapper">
					</div>
					<span style="display: block; margin-top: 20px; margin-bottom: 10px; margin-left: 20px; font: bold normal 16px sans-serif;" id="playback-quality-title">Playback Quality</span>
					<div class="chart-inventory" style="margin-bottom: 30px;">
						<flot dataset="chartData.playbackQuality" options="chartOptions.playbackQuality"></flot>
					</div>
					<div id="legend-wrapper_rtt" class="legend-wrapper">
					</div>
					<span style="display: block; margin-top: 20px; margin-bottom: 10px; margin-left: 20px; font: bold normal 16px sans-serif;" id="rtt-title">Path RTT</span>
					<div class="chart-inventory" style="margin-bottom: 30px;">
						<flot dataset="chartData.rtt" options="chartOptions.rtt"></flot>
					</div>
					<div id="legend-wrapper_throughput" class="legend-wrapper">
					</div>
					<span style="display: block; margin-top: 20px; margin-bottom: 10px; margin-left: 20px; font: bold normal 16px sans-serif;" id="throughput-title">Path Throughput</span>
					<div class="chart-inventory" style="margin-bottom: 30px;">
						<flot dataset="chartData.throughput" options="chartOptions.throughput"></flot>
					</div>
				</div>

			</div>

			<!-- List of all requests -->
			<div class="row" style="background-color: #ffffff">
				<div id="request-list" class="table-striped" style="margin: 15px;">
					<table class="table table-striped" style="border: 3px solid #136bfb; padding-left: 5px;padding-right: 5px; text-align: center;">
						<thead>
						<tr>
							<th style="text-align: center;">Type</th>
							<th style="text-align: center;">Content</th>
							<th style="text-align: center;">Path</th>
							<th style="text-align: center;">Period</th>
							<th style="text-align: center;">AdaptationSet</th>
							<th style="text-align: center;">Representation</th>
							<th style="text-align: center;">Segment</th>
							<!-- <th style="text-align: center;">tresponse_trequest</th>
							<th style="text-align: center;">tfinish_tresponse</th>
							<th style="text-align: center;">tfinish_trequest</th>
							<th style="text-align: center;">tsize</th> -->
							<th style="text-align: center;">RTT</th>
							<th style="text-align: center;">Throughput</th>
							<th style="text-align: center;">Throughput Expect</th>
						</tr>
						</thead>
						<tbody>
						<tr ng-repeat="item in requestList">
							<td>{{item.urlType}}</td>
							<td>{{item.contentType}}</td>
							<td>{{item.pathIndex}}</td>
							<td>{{item.periodIndex}}</td>
							<td>{{item.adaptationSetIndex}}</td>
							<td>{{item.representationIndex}}</td>
							<td>{{item.segmentIndex}}</td>
							<!-- <td>{{item.tresponse_trequest}}</td>
							<td>{{item.tfinish_tresponse}}</td>
							<td>{{item.tfinish_trequest}}</td>
							<td>{{item.tsize}}</td> -->
							<td>{{item.rtt}}</td>
							<td>{{item.throughput}}</td>
							<td>{{item.throughputExpect}}</td>
						</tr>
						</tbody>
					</table>
				</div>
			</div>

		</div>

	</body>
	
</html>